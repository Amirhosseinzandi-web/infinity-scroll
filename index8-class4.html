<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
        /* ::-webkit-scrollbar{
          display: none;
        } */
        main{
          width: 100%;
          height: 100vh;
          /* overflow-y: scroll; */
        }
        .container{
            height: 100vh;
            display: flex;
          justify-content: space-evenly;
          align-items: center;
          flex-wrap: wrap;
        }
        main>.container>section{
          /* border: 1px solid black; */
          width: 30%;
          height: 300px;
          display: flex;
          margin: 20px;
        }
        main>.container>section>div{
          width: 50%;
          height: 100%;
          border: 1px solid black;
        }
        main>.container>section>div img{
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
        .pic{
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%,-50%);
        }
        .add{
          overflow-y: scroll;
        }
        .remove{
          overflow-y: hidden;
        }
        .hide{
          display: none;
        }
        
      </style>
</head>
<body>
        <main class="add">
            <div class="container">

            </div>
        </main>
    <div class="pic">
      
    </div>
</body>
<script>


    function showLoading(){
      document.querySelector(".pic").innerHTML = "<img src='https://wpamelia.com/wp-content/uploads/2018/11/ezgif-2-6d0b072c3d3f.gif'>"
    }

    function hideLoading(){
      document.querySelector(".pic").innerHTML = "<img class='hide' src='https://wpamelia.com/wp-content/uploads/2018/11/ezgif-2-6d0b072c3d3f.gif'>"
    }

    let url = "https://jsonplaceholder.typicode.com/photos"
    let _main = document.getElementsByTagName("main")[0]
    let picUrl = "https://randomuser.me/api/?results=500"
  
    
    async function amir(){
          showLoading()
         _file = await fetch(url)
         _data = await _file.json()
         return _data
         
     }

    async function rozi(){
          // showLoading()
         _photo = await fetch(picUrl)
         _pic = await _photo.json()
         return _pic
     }

     amir().then((response)=>{
       rozi().then((suces)=>{
        console.log(suces)
        hideLoading()
         reza(response,suces)
       })
     })
   
    









    function reza(response,suces){
        class shortStory{
        constructor(title , img , desk , price){
            this.title = title;
            this.img = img;
            this.desk = desk;
            this.price = price;
        }
        Text(){
           let _div1 = document.createElement("div")
            _div1.innerHTML =` <h2>${this.title}</h2> <p>${this.desk}</p> <strong>${this.price}</strong>`
            return _div1
        }
        Img(){
           let _div2 = document.createElement("div")
            _div2.innerHTML =` <img src="${this.img}"> `
            return _div2
        }
        finall(){
            let _sec = document.createElement("section")
            _sec.appendChild(this.Text())
            _sec.appendChild(this.Img())
            return _sec
        }
    }
     // **************************************************************************************
                
             
             
                
    let z;
       let k = 10
      //  let j=0;
        for(i=0; i<10; i++){

            x = new shortStory(response[i].title , suces.results[i].picture.large , response[i].albumId , response[i].id)
            document.querySelector(".container").appendChild(x.finall())

            }
       
        function ahmad(){
          _main.scrollTo(0,(_main.scrollTop -120))
        }
        
        let scr = true
            _main.addEventListener("scroll" , function(){
              // console.log(_main.scrollTop + window.innerHeight + " - " + Number(_main.scrollHeight -100))
              // console.log(_main.scrollTop)
              // console.log(_main.scrollTop + " - " + window.innerHeight)
        if(((_main.scrollTop) + window.innerHeight) >= (_main.scrollHeight)-100){
          // console.log(response.length)
        //  z = setTimeout(showLoading , 0)
        if(scr==true){
          showLoading()
            z = setTimeout(ahmad , 0)
            _main.classList.replace("add" , "remove")
          }
        
        if (document.querySelector(".container").childElementCount >= (response.length -10))  {
          
          scr = false
          _main.removeEventListener("scroll" , function(){}) 
        } 
        console.log(scr)
        setTimeout(()=>{
          _main.classList.replace("remove" , "add")
          console.log(document.querySelector(".container").childElementCount + " - " + response.length)
        // document.querySelector(".pic").innerHTML = showLoading()
        
            if(document.querySelector(".container").childElementCount >= response.length)  {
              
              // for(i=0; i<response.length; i++){

              //   x = new shortStory(response[i].title , response[i].url , response[i].albumId , response[i].id)
              //   document.querySelector(".container").appendChild(x.finall())
              //   console.log(response.length)
              //   }
              
              
              
              _main.removeEventListener("scroll" , function(){}) 
              // return
              // alert("yt")
            }
            
            else{
              hideLoading()
              for(j = k; j < k + 10; j++){
                x = new shortStory(response[j].title , suces.results[j].picture.large , response[j].albumId , response[j].id)
                document.querySelector(".container").appendChild(x.finall())
                
                
              //  console.log(j)
                }
                k = k + 10
            }
            // console.log(i + " - " + j + " - " + k)
            
            
          
        },800)
        }
       
     })
         
     
             
        // *****************************************************************************************
    }


                

   
   
</script>
</html>